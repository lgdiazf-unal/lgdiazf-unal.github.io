---
title: BIND9
date: 2025-10-27 12:00:00 -5000
categories: [NETWORK, DNS]
tags: [dns]
---

BIND9 (Berkeley Internet Name Domain versión 9) es el servidor de DNS (Sistema de Nombres de Dominio) más utilizado en Internet, especialmente en sistemas Unix y GNU/Linux, donde es un estándar de facto.


En este post se describen los pasos necesarios para desplegar una solución DNS en arquitectura **master–worker** utilizando máquinas virtuales con **AlmaLinux 8**. Para ello nos basamos en el tutorial [Install and Configure BIND 9 Master and Slave DNS Server for Local Network using AlmaLinux 9](https://www.youtube.com/watch?v=4yKN9r48vo0)

## Escenario

Se crearán dos servidores DNS:

+ **Servidor principal (master).**
+ **Servidor de respaldo (slave).**

Ambos estarán desplegados en una subred dedicada al servicio de DNS.
Para poner la solución en práctica, en otra subred se desplegará un servidor Linux que servirá de entorno de pruebas.

Además, se creará la zona lab.test.

![Arquitectura](../assets/img/bind9/arquitectura.png)


## Instalacion

En cada servidor DNS se deben ejecutar los siguientes comandos:

### 1. Actualizar los paquetes

Para garantizar que los repositorios contengan la última versión de los paquetes, primero se actualizan los mismos con el siguiente comando:

```bash
sudo yum -y update
```

### 2. Instalar bind9

Con los repositorios actualizados, instalar los paquetes necesarios para ejecutar el servicio de DNS:

```bash
sudo yum install -y bind bind-utils
```

### 3. Habilitar el servicio

Para finalizar, se debe habilitar el servicio de modo que se inicie automáticamente cada vez que arranquen las máquinas:

```bash
sudo systemctl enable named --now
```

## Configuración

Una vez instalado BIND en todos los servidores DNS, es momento de configurarlos. Cada rol maestro y esclavo requiere una configuración distinta.


### Servidor Master



#### 1. Configuración de consultas

El maestro realizará la mayor parte de las configuraciones. En primer lugar, edite el archivo ***/etc/named.conf*** .

Dentro de ese archivo cree un ACL `(access control list)` que incluya todas las subredes que necesiten acceder al servicio. Para facilitar la lectura, colóquelo al inicio del fichero.

```conf

acl  vms{
    10.10.35.1/24;
};

```

Posteriormente, en la sección options se añade el DNS al que se enviarán las consultas que no se resuelvan dentro de la zona local.
Para ello se utiliza la directiva **forwarders**:

```conf
options {
    forwarders {
        8.8.8.8;
        1.1.1.1;
    };
...
};
```


Para que los clientes puedan consultar el servidor DNS, se deben configurar las directivas **listen-on port 53** y **allow-query** añadiendo las ACLs pertinentes. En este escenario, utilizaremos dos listas de control de acceso (ACL):

+ **vms** – creada explícitamente para incluir las máquinas virtuales que requieren acceso al DNS.
+ **localnets** – una ACL automática que coincide con todas las direcciones IP y máscaras de subred de las interfaces de red del host donde se ejecuta BIND.

Estas configuraciones asegurarán que el servidor escuche únicamente en el puerto 53 y que solo los hosts pertenecientes a `vms` y a `localnets` puedan efectuar consultas DNS.

```conf
options {
    ...
    listen-on port 53 { vms; localnets; };
    ...
    allow-query {  vms; localnets;   };
...
};
```

Por último, para garantizar la correcta replicación de las zonas al servidor esclavo (DNS worker), se debe añadir la directiva **allow-transfer**, indicando la dirección IP del DNS secundario.


```conf
options {
    ...
   allow-transfer {10.10.34.3/32;};
...
};
```

#### 2. Configuración de zonas

Para crear una zona DNS nueva se deben generar dos tipos de archivos: zona directa (forward) y zona inversa (reverse).

+ **Zona directa (forward)** – contiene los registros que traducen nombres de dominio a direcciones IP.
+ **Zona inversa (reverse)** – resuelve direcciones IP a los nombres de dominio correspondientes; es esencial para la verificación de correo electrónico y el diagnóstico de red.

Para comenzar, se debe editar el archivo ***/etc/named.rfc1912.zones*** y añadir la zona directa.

Como este servidor es el nodo maestro, la directiva `type` debe establecerse en `master`.

```conf
...
zone "lab.test" {
	type master;
	file "/var/named/forward.lab.test";
	allow-update {none; };
};
...
```
+ Se incorporan las zonas inversas; al contar con dos subredes diferentes, se crean dos zonas reverse distintas.

```conf
...

zone "34.10.10.in-addr.arpa" {
	type master;
	file "/var/named/reverse.lab.test";
	allow-update {none; };
};

zone "35.10.10.in-addr.arpa" {
	type master;
	file "/var/named/reverse-vms.lab.test";
	allow-update {none; };
};

```
Para verificar que la configuración de BIND sea válida, ejecute el siguiente comando (debe completarse sin ningún mensaje de error):

```bash
sudo named-checkconf
```

A continuación, se crean los archivos que contendrán la información de cada zona DNS.

`/var/named/forward.lab.test`

```conf
$TTL    2d              ; TTL por defecto para la zona
@       IN      SOA     ns1.lab.test. root.lab.test. (
                        2003080800      ; serial
                        43200           ; refresh (12h)
                        900             ; retry (15m)
                        1814400         ; expiry (3w)
                        7200            ; minimum (2h)
                        )

; Servidores de nombres
@       IN      NS      ns1.lab.test.
@       IN      NS      ns2.lab.test.

; Registros A para los nameservers
ns1     IN      A       10.10.34.2
ns2     IN      A       10.10.34.3
; Registro de la VM01
vm1     IN      A       10.10.35.4
```

`/var/named/reverse.lab.test`

```conf
$TTL 1D
@        IN        SOA  ns1.lab.test. root.lab.test. (
                        2007091701 ; serial
                        30800      ; refresh
                        7200       ; retry
                        604800     ; expire
                        300 )      ; minimum
@   IN	NS	ns1.lab.test.
@   IN	NS	ns2.lab.test.

2   IN	PTR	ns1.lab.test.
3   IN 	PTR	ns2.lab.test.
```

`/var/named/reverse-vms.lab.test`

```conf
$TTL 1D
@        IN        SOA  ns1.lab.test. root.lab.test. (
                        2007091701 ; serial
                        30800      ; refresh
                        7200       ; retry
                        604800     ; expire
                        300 )      ; minimum
@	IN	NS	ns1.lab.test.
@   IN	NS	ns2.lab.test.

4	IN	PTR	vm1.lab.test.
```

Para comprobar que las zonas se han creado correctamente, se ejecutan los siguientes comandos.

```bash
sudo named-checkzone lab.test /var/named/forward.lab.test
sudo named-checkzone reverse.lab.test /var/named/reverse.lab.test
sudo named-checkzone  reverse-vms.lab.test /var/named/reverse-vms.lab.test
```

Si la configuración pasa la validación sin errores, se procede a reiniciar el servicio:

```bash
sudo systemctl restart named
```

### Servidor Worker

Para habilitar la replicación de las zonas, se deben editar los archivos ***/etc/named.conf*** y ***/etc/named.rfc1912.zones***.

En ***/etc/named.conf*** se requiere:

+ Crear el `acl` con la IPs de los servidores esclavos.
+ Añadir la clave **forwarders** (si se desea que el worker realice consultas a servidores “upstream”).
+ Ajustar **listen-on port 53** y **allow-query** de la misma manera que en el nodo maestro.

**Importante**: no se debe incluir la directiva `allow-transfer` en el worker, ya que la transferencia de zonas se controla únicamente desde el nodo maestro.


```conf

acl  vms{
    10.10.35.1/24;
};


options {
    forwarders {
        8.8.8.8;
        1.1.1.1;
    };
    listen-on port 53 { vms; localnets; };
    ...
    allow-query {  vms; localnets;   };
...
};
```

Además, se deben registrar las zonas en ***/etc/named.rfc1912.zones***. En este archivo, la directiva `type` debe ser **slave** y, en lugar de `allow-update`, se incluye `masters` con la dirección IP del DNS maestro.

```conf
...

zone "lab.test" {
	type slave;
	file "/var/named/forward.lab.test";
	masters {10.10.34.2;};
};

zone "34.10.10.in-addr.arpa" {
	type slave;
	file "/var/named/reverse.lab.test";
	masters {10.10.34.2;};
};

zone "35.10.10.in-addr.arpa" {
	type slave;
	file "/var/named/reverse-vms.lab.test";
	masters {10.10.34.2;};
};

```

Se verifica la configuración.

```bash
sudo named-checkconf
```

Si la configuración pasa la validación sin errores, se procede a reiniciar el servicio:

```bash
sudo systemctl restart named
```

## Configuración del DNS en la VM de prueba


Se edita el archivo ***/etc/resolv.conf***, apuntando a las direcciones IP de los dos servidores DNS:


```conf
nameserver 10.10.34.2
nameserver 10.10.34.3
```

Se valida la instalación con pruebas de resolución, usando tanto nombres como direcciones IP:

```bash
nslookup ns1.lab.test # retorna la ip
nslookup 10.10.34.2 # retorna el nombre
```